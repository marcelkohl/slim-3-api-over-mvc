<?php

use App\Model\EmployeeModel;
use App\Model\DBObject\EmployeeDbo;

class EmployeeModeltest extends Slim3TestCase
{
    /**
     * the id of the employee to be used as reference to test, must exist on database
     * @var int
     */
    private $singleEmployeeId;

    public function setUp()
    {
        parent::setUp();
        $this->singleEmployeeId = 1;
    }

    /**
     * serialize dbo test
     */
    public function testSerializeDbo()
    {
        $employee = EmployeeDbo::getById($this->app->getContainer()->get("db"), $this->singleEmployeeId);
        $employeeModel = new EmployeeModel($this->app->getContainer()->get("db"));

        $serialized = $employeeModel->serializeDbo($employee);

        $this->assertEquals($employee->getId(), $serialized["id"], "Serialized Id MUST match Dbo Id");
        $this->assertEquals($employee->getName(), $serialized["name"], "Serialized Name MUST match Dbo Name");
    }

    /**
     * add employee dbo test
     */
    public function testAddEmployee()
    {
        $employeeModel = new EmployeeModel($this->app->getContainer()->get("db"));
        $employeeName = "employee unit test";
        $addedEmployee = $employeeModel->addEmployee($employeeName);

        $dbEmployee = EmployeeDbo::getById($this->app->getContainer()->get("db"), $addedEmployee->getId());

        $this->assertInstanceOf(EmployeeDbo::class, $dbEmployee, "Employee instance MUST match model added employee");
        $this->assertEquals($addedEmployee->getId(), $dbEmployee->getId(), "added employee Id MUST match Db instantiated Id");
    }
}
